# Windows Inactivity Shutdown & Utilities

This repository contains a set of batch scripts designed to manage your Windows system's power state based on user inactivity. It's ideal for automated power management, energy saving, or ensuring your PC shuts down after a period of non-use.

---

## Scripts Included

### `ShutdownTimeout.bat`
This is the core script for monitoring user inactivity and initiating a shutdown.

### `WarningShutdownLoop.bat`
A new script that provides recurring shutdown warnings if a window remains open.

### `ClearLogs.bat`
A utility script to remove all temporary files generated by `ShutdownTimeout.bat`.

### `ShutdownTest.bat`
A simple test script to verify that the `shutdown` command works on your system.

### `ShutdownPrivilegeTest.bat`
A test script to check if your user account has the necessary permissions to initiate and cancel a system shutdown.

---

## How `ShutdownTimeout.bat` Works

This script acts as an **inactivity monitor** for your Windows system. It continuously tracks user activity (keyboard and mouse input) and performs actions based on configurable inactivity thresholds:

* **Initial Permissions Check**: On its first run, or if previous tests failed, the script performs a series of checks to ensure all necessary system components (like `powershell.exe`, `msg`, `shutdown`, and file system access) are available. The results are logged, and if any critical component is missing, the script won't proceed. This ensures reliable operation and provides an error message if permissions are lacking.
* **Warning Notification**: If no activity is detected for **40 minutes**, a warning message will pop up on your screen. This message notifies you that the computer will shut down in **5 more minutes** if inactivity persists.
* **Automatic Shutdown**: If inactivity continues for a total of **45 minutes** (40 minutes plus the 5-minute warning period), the script will initiate an immediate and forced shutdown of the system.
* **Activity Reset**: If activity is detected after a warning has been issued but before the shutdown threshold is met, the inactivity counter and warning flag are reset.
* **Logging**: All significant events, including startup, inactivity levels, warnings, and shutdowns, are recorded in a log file located in your temporary directory (`%TEMP%\shutdown_log.txt`).

This script is ideal for managing energy consumption, ensuring systems are turned off when not in use, or for environments where unattended machines should automatically power down.

---

## How `WarningShutdownLoop.bat` Works

This script provides a recurring on-screen warning that triggers a system shutdown if unaddressed. It's designed to operate without administrator privileges, making it suitable for standard user accounts.

* **Timed Warning Display**: Every **55 minutes**, a command prompt window will appear with a warning message.
* **Shutdown Trigger**: If this warning window remains open for **5 minutes**, the script will attempt to initiate an immediate system shutdown.
* **Reset on Interaction**: Any interaction that closes the warning window (e.g., clicking the 'X' button, pressing `Alt+F4`, or manually closing the window) will immediately **reset the 55-minute timer**. The script will then wait another 55 minutes before displaying the warning again.
* **Continuous Operation**: The script is designed to run continuously in the background from system startup until a shutdown occurs due to inactivity.

**Important Note on Permissions**: Since this script runs without administrator privileges, its ability to force a system shutdown is limited. Windows security measures might prevent a complete forced shutdown or prompt for user confirmation. The script attempts the shutdown command, but its success depends on the specific user permissions and system security policies.

---

## Usage

### Setting Up `ShutdownTimeout.bat`

1.  **Save the script**: Save the provided code for `ShutdownTimeout.bat` as a `.bat` file (e.g., `inactivity_shutdown.bat`).
2.  **First Run / Initial Setup**:
    * When you run the script for the first time, it will execute a series of **initial functionality tests**. These tests verify that all required commands (`powershell.exe`, `msg`, `shutdown`) and file system permissions are correctly set up.
    * The results of these tests will be logged to `%TEMP%\shutdown_log.txt`.
    * If all tests pass, the script will directly proceed to the main monitoring operation without showing additional messages.
    * If any test fails, an error message will be displayed, explaining that critical components are missing or inaccessible, and the script will exit. You should check the `%TEMP%\shutdown_log.txt` file for details on what failed.
3.  **Subsequent Runs**: After a successful initial test, the script will detect its previous successful run and **skip the tests**, directly starting the inactivity monitoring.
4.  **Background Operation**: Once running, the script operates silently in the background, continuously monitoring for user inactivity.
5.  **Monitoring Log**: You can review the activity and status of the script at any time by checking the log file: `%TEMP%\shutdown_log.txt`.
6.  **Configuration**: You can adjust the inactivity thresholds (`CHECK_INTERVAL`, `WARNING_THRESHOLD`, `SHUTDOWN_THRESHOLD`) by editing the `SET` variables at the beginning of the `ShutdownTimeout.bat` file.

### Setting Up `WarningShutdownLoop.bat`

1.  **Save the script**: Save the provided code for `WarningShutdownLoop.bat` as a `.bat` file (e.g., `warning_shutdown_loop.bat`).
2.  **Run at Startup**: To have the script run automatically each time you log in:
    * Create a **shortcut** to the `warning_shutdown_loop.bat` file.
    * Press `Windows + R`, type `shell:startup`, and press Enter.
    * Move or copy the created shortcut into this "Startup" folder.
3.  **Configuration**: You can adjust the timing for the warning (`DELAY_BEFORE_WARNING_SECONDS`) and the duration the warning stays on screen before shutdown attempt (`WARNING_DURATION_SECONDS`) by editing the `SET` variables at the beginning of the `WarningShutdownLoop.bat` file.

### Using Utility Scripts

* **`ClearLogs.bat`**: Simply run this batch file to delete all temporary `.txt` files generated by `ShutdownTimeout.bat`.
* **`ShutdownTest.bat`**: Run this script to perform a quick test of the `shutdown` command. It will attempt to shut down your system in 10 seconds with a confirmation message.
* **`ShutdownPrivilegeTest.bat`**: Execute this script to test your user's permissions for initiating and canceling a shutdown. It will attempt to start a shutdown in 20 seconds and then immediately try to cancel it.

---

### Created by

**xvacorx**

* **GitHub**: [https://github.com/xvacorx](https://github.com/xvacorx)
* **Itch.io**: [https://xvacorx.itch.io/](https://xvacorx.itch.io/)
* **LinkedIn**: [https://www.linkedin.com/in/victor-g-sanchez/](https://www.linkedin.com/in/victor-g-sanchez/)
